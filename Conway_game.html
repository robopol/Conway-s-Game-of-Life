<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Conway's Game of Life simulation with various rule sets, patterns, and customization options. An interactive cellular automaton developed by ing. Robert Polak.">
    <meta name="keywords" content="Conway's Game of Life, cellular automaton, simulation, John Horton Conway, interactive game, mathematical patterns">
    <meta name="author" content="ing. Robert Polak">
    <meta name="theme-color" content="#121212">
    <title>Conway's Game of Life - Interactive Cellular Automaton Simulator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Favicon from data URI -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ§®</text></svg>">
    <meta name="msapplication-TileColor" content="#8e44ad">
    <style>
        /* Modern Dark Mode Styling */
        :root {
            --primary-color: #8e44ad;
            --accent-color: #3498db;
            --dark-bg: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --border-radius: 12px;
            --shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
            --btn-hover: #9b59b6;
            --btn-active: #8e44ad;
            --accent-glow: rgba(52, 152, 219, 0.5);
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--dark-bg);
            background-image: radial-gradient(circle at top right, rgba(121, 68, 154, 0.13), transparent),
                               radial-gradient(circle at 20% 80%, rgba(41, 128, 185, 0.1), transparent);
            color: var(--text-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            position: relative; 
        }
        
        /* Main Container */
        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-align: center;
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0px 2px 2px rgba(0, 0, 0, 0.3));
        }
        
        /* Controls Section */
        #controls {
            width: 100%;
            max-width: 900px;
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Control Buttons */
        #controlButtons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        #controlButtons button {
            padding: 12px 18px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(145deg, var(--primary-color), #7d3c98);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 120px;
        }
        
        #controlButtons button i {
            margin-right: 8px;
        }
        
        #controlButtons button:hover {
            background-color: var(--accent-color);
            box-shadow: 0 0 15px var(--accent-glow);
        }
        
        #controlButtons button:active {
            background: var(--btn-active);
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        /* Settings Panel */
        #settingsPanel {
            display: none;
            margin-top: 20px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: var(--border-radius);
            padding: 0;
            border: 1px solid rgba(255, 255, 255, 0.05);
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        /* Tabs Navigation */
        .settings-tabs {
            display: flex;
            background-color: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .tab-button {
            padding: 12px 20px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-weight: 500;
            position: relative;
            transition: all 0.3s;
            flex: 1;
            text-align: center;
            font-size: 14px;
        }
        
        .tab-button:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: #fff;
        }
        
        .tab-button.active {
            color: #fff;
            background-color: rgba(142, 68, 173, 0.2);
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 3px;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color));
            border-radius: 3px 3px 0 0;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
            padding: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Setting Groups */
        .settings-group {
            margin-bottom: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding-bottom: 20px;
        }
        
        .settings-group:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .settings-group h3 {
            margin: 0 0 15px 0;
            font-size: 16px;
            font-weight: 600;
            color: var(--accent-color);
            display: flex;
            align-items: center;
        }
        
        .settings-group h3 i {
            margin-right: 8px;
        }
        
        /* Setting Rows */
        .setting-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .setting-row:last-child {
            margin-bottom: 0;
        }
        
        .setting-row label {
            flex: 1;
            min-width: 160px;
            margin-bottom: 5px;
        }
        
        .setting-row .input-wrapper {
            flex: 2;
            min-width: 150px;
            position: relative;
        }
        
        /* Enhanced Color Picker */
        .color-picker-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 2;
        }
        
        .color-preview {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            position: relative;
        }
        
        input[type="color"] {
            position: absolute;
            width: 50px;
            height: 50px;
            border: none;
            cursor: pointer;
            padding: 0;
            background: none;
            top: -5px;
            left: -5px;
            opacity: 0;
        }
        
        .color-value {
            background-color: rgba(0, 0, 0, 0.4);
            padding: 8px 12px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 80px;
            text-align: center;
        }
        
        /* Preset Colors */
        .color-presets {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        
        .color-preset {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
            transition: transform 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .color-preset:hover {
            transform: scale(1.1);
        }
        
        /* Range Sliders */
        .slider-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            margin-top: 5px;
        }
        
        .slider-wrapper {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .slider {
            flex: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            background: var(--accent-color);
        }
        
        .slider-value {
            width: 40px;
            text-align: center;
            font-weight: bold;
        }
        
        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 54px;
            height: 28px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.1);
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--accent-color);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        /* Select Styling */
        select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='rgba(255, 255, 255, 0.5)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 15px;
            padding-right: 30px;
        }
        
        /* Settings Action Buttons */
        .settings-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
            gap: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            padding-top: 20px;
        }
        
        .settings-action-btn {
            padding: 10px 20px;
            border-radius: 30px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .settings-action-btn.primary {
            background: linear-gradient(145deg, var(--primary-color), #7d3c98);
        }
        
        .settings-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        /* Canvas Styling */
        #gameCanvas {
            border: 2px solid rgba(255, 255, 255, 0.1);
            background-color: #000000;
            border-radius: var(--border-radius);
            max-width: 100%;
            height: auto;
            display: block;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
        }
        
        #gameCanvas:hover {
            transform: scale(1.01);
        }
        
        /* Canvas Container for mobile interactions */
        .canvas-container {
            position: relative;
            overflow: hidden;
            touch-action: none;
            max-width: 100%;
            margin: 0 auto;
        }
        
        /* Mobile zoom controls */
        .mobile-controls {
            display: none;
            position: absolute;
            bottom: 10px;
            right: 10px;
            z-index: 10;
        }
        
        .mobile-controls button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(142, 68, 173, 0.7);
            color: white;
            border: none;
            margin: 5px;
            font-size: 18px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            opacity: 0.8;
            touch-action: none;
        }
        
        .mobile-controls button:active {
            opacity: 1;
            transform: scale(0.95);
        }
        
        @media (max-width: 600px) {
            .mobile-controls {
                display: flex;
            }
        }
        
        /* Footer Styling */
        footer {
            text-align: center;
            padding: 15px 0;
            background-color: rgba(0, 0, 0, 0.3);
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            width: 100%;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        /* Description Styling */
        #description {
            max-width: 900px;
            margin-top: 30px;
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: flex-start;
            gap: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        #description img {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }
        
        #description img:hover {
            transform: scale(1.05);
        }
        
        #descriptionContent {
            flex: 1;
        }
        
        #descriptionContent p {
            line-height: 1.6;
        }
        
        #descriptionContent ol {
            padding-left: 20px;
        }
        
        #descriptionContent li {
            margin-bottom: 10px;
        }
        
        /* Description Styling */
        .description-container {
            max-width: 900px;
            margin-top: 30px;
            width: 100%;
        }
        
        #showDescriptionBtn {
            width: 100%;
            padding: 15px;
            background-color: var(--card-bg);
            color: var(--text-color);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow);
            transition: all 0.3s;
        }
        
        #showDescriptionBtn:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        #showDescriptionBtn i {
            transition: transform 0.3s;
        }
        
        #showDescriptionBtn.active i {
            transform: rotate(180deg);
        }
        
        #description {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, padding 0.3s ease, opacity 0.3s ease;
            opacity: 0;
            padding: 0 25px;
            margin-top: 0;
            border-top: none;
            border-top-left-radius: 0;
            border-top-right-radius: 0;
        }
        
        #description.show {
            max-height: 2000px;
            padding: 25px;
            opacity: 1;
            margin-top: 1px;
        }
        
        /* Responsive Layout */
        @media (max-width: 900px) {
            h1 {
                font-size: 2rem;
            }
            
            #controls > div {
                flex-direction: column;
                align-items: flex-start;
            }
            
            label {
                margin-bottom: 5px;
                min-width: 100%;
            }
            
            input[type="number"], 
            input[type="color"], 
            select, 
            input[type="text"] {
                width: 100%;
                min-width: 100%;
            }
            
            #description {
                flex-direction: column;
                align-items: center;
                padding: 15px;
            }
            
            #description img {
                margin: 0 0 20px 0;
            }
            
            #descriptionContent {
                width: 100%;
            }
            
            #controlButtons button {
                min-width: 100%;
            }
        }
        
        /* Mobile Optimization */
        @media (max-width: 600px) {
            body {
                padding: 0;
                margin: 0;
            }
            
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.8rem;
                margin-top: 5px;
                margin-bottom: 10px;
            }
            
            #controls {
                padding: 10px;
                margin-bottom: 10px;
            }
            
            /* Mobile-friendly buttons */
            #controlButtons {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }
            
            #controlButtons button {
                padding: 10px;
                font-size: 13px;
                min-height: 44px; /* Touch-friendly size */
            }
            
            #controlButtons button i {
                margin-right: 5px;
                font-size: 14px;
            }
            
            /* Improved settings panel for mobile */
            .settings-tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .tab-button {
                font-size: 13px;
                padding: 10px;
                white-space: nowrap;
            }
            
            .tab-content {
                padding: 10px;
            }
            
            .setting-row {
                margin-bottom: 10px;
            }
            
            /* Make color pickers more touch-friendly */
            .color-preview {
                width: 30px;
                height: 30px;
            }
            
            .color-preset {
                width: 30px;
                height: 30px;
                margin: 2px;
            }
            
            /* Canvas adjustments */
            #gameCanvas {
                max-width: 100%;
                height: auto;
                touch-action: none; /* Prevent default touch actions */
            }
            
            /* Description adjustments */
            #showDescriptionBtn {
                padding: 10px;
                font-size: 14px;
            }
            
            #description {
                padding: 10px;
            }
            
            #description img {
                width: 100px;
                height: 100px;
            }
            
            /* Notification improvement */
            #notification {
                width: 90%;
                max-width: 300px;
                box-sizing: border-box;
                font-size: 14px;
                padding: 8px 15px;
            }
        }
        
        /* Tablet Optimization */
        @media (min-width: 601px) and (max-width: 900px) {
            #controlButtons {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr;
                gap: 10px;
            }
            
            #controlButtons button {
                min-height: 44px; /* Touch-friendly size */
            }
        }
        
        /* Tooltip Styling */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -60px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* Button Hover Effect */
        #controlButtons button:hover {
            background-color: var(--accent-color);
            box-shadow: 0 0 15px var(--accent-glow);
        }
        
        /* Button Active State */
        #controlButtons button.active {
            background-color: var(--accent-color);
            box-shadow: 0 0 15px var(--accent-glow);
        }
        
        /* Fullscreen button in active state */
        #fullscreenToggle.active {
            background-color: var(--accent-color);
            box-shadow: 0 0 15px var(--accent-glow);
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Conway's Game of Life</h1>

        <div id="controls">
            <div id="controlButtons">
                <button id="setupGrid" aria-label="Setup Grid: Initialize the grid with current settings">
                    <i class="fas fa-border-all"></i> Setup Grid
                </button>
                <button id="startSimulation" aria-label="Start Simulation: Begin evolving the cells according to rules">
                    <i class="fas fa-play"></i> Start
                </button>
                <button id="pauseSimulation" aria-label="Stop Simulation: Pause the current simulation">
                    <i class="fas fa-stop"></i> Stop
                </button>
                <button id="resetGrid" aria-label="Reset Grid: Clear all cells from the grid">
                    <i class="fas fa-trash-alt"></i> Reset
                </button>
                <button id="saveGrid" aria-label="Save Map: Download current configuration as a file">
                    <i class="fas fa-save"></i> Save
                </button>
                <button id="loadGrid" aria-label="Load Map: Load a previously saved configuration">
                    <i class="fas fa-upload"></i> Load
                </button>
                <button id="fullscreenToggle" aria-label="Fullscreen: Toggle fullscreen mode">
                    <i class="fas fa-expand"></i> Fullscreen
                </button>
                <button id="configure" aria-label="Configure: Adjust settings for the simulation">
                    <i class="fas fa-cog"></i> Settings
                </button>
                <input type="file" id="fileInput" accept=".json" style="display:none;">
            </div>

            <div id="settingsPanel">
                <div class="settings-tabs">
                    <button class="tab-button active" data-tab="general"><i class="fas fa-sliders-h"></i> General</button>
                    <button class="tab-button" data-tab="visual"><i class="fas fa-palette"></i> Visual</button>
                    <button class="tab-button" data-tab="advanced"><i class="fas fa-cogs"></i> Advanced</button>
                </div>
                
                <!-- General Settings Tab -->
                <div class="tab-content active" id="general">
                    <div class="settings-group">
                        <h3><i class="fas fa-th"></i> Grid Dimensions</h3>
                        <div class="setting-row">
                            <label for="rows">Number of Rows:</label>
                            <div class="input-wrapper">
                                <input type="number" id="rows" value="50" min="10" max="200">
                            </div>
                        </div>
                        <div class="setting-row">
                            <label for="cols">Number of Columns:</label>
                            <div class="input-wrapper">
                                <input type="number" id="cols" value="50" min="10" max="200">
                            </div>
                        </div>
                        <div class="setting-row">
                            <label for="canvasWidth">Canvas Width (px):</label>
                            <div class="input-wrapper">
                                <input type="number" id="canvasWidth" value="800" min="200" max="1920">
                            </div>
                        </div>
                        <div class="setting-row">
                            <label for="canvasHeight">Canvas Height (px):</label>
                            <div class="input-wrapper">
                                <input type="number" id="canvasHeight" value="800" min="200" max="1080">
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <h3><i class="fas fa-play-circle"></i> Simulation</h3>
                        <div class="setting-row">
                            <label for="speed">Speed (FPS):</label>
                            <div class="input-wrapper">
                                <div class="slider-container">
                                    <div class="slider-wrapper">
                                        <input type="range" id="speedSlider" class="slider" min="1" max="60" value="10">
                                        <span class="slider-value" id="speedValue">10</span>
                                    </div>
                                </div>
                                <input type="hidden" id="speed" value="10">
                            </div>
                        </div>
                        <div class="setting-row">
                            <label for="pattern">Initial Pattern:</label>
                            <div class="input-wrapper">
                                <select id="pattern">
                                    <option value="None">None (Random)</option>
                                    <option value="Blinker">Blinker</option>
                                    <option value="Glider">Glider</option>
                                    <option value="Block">Block</option>
                                    <option value="Toad">Toad</option>
                                    <option value="Beacon">Beacon</option>
                                    <option value="Pulsar">Pulsar</option>
                                    <option value="Pentadecathlon">Pentadecathlon</option>
                                    <option value="LWSS">LWSS</option>
                                </select>
                            </div>
                        </div>
                        <div class="setting-row">
                            <label for="creativeMode">Creative Mode:</label>
                            <div class="input-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="creativeMode">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="setting-row">
                            <label for="symmetricPatterns">Symmetric Patterns:</label>
                            <div class="input-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="symmetricPatterns">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="setting-row" id="symmetricSettings" style="display: none;">
                            <label for="squareSize">Square Size:</label>
                            <div class="input-wrapper">
                                <input type="number" id="squareSize" value="10" min="1" max="100">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Visual Settings Tab -->
                <div class="tab-content" id="visual">
                    <div class="settings-group">
                        <h3><i class="fas fa-fill-drip"></i> Colors</h3>
                        <div class="setting-row">
                            <label for="bgColor">Background Color:</label>
                            <div class="color-picker-wrapper">
                                <div class="color-preview" style="background-color: #0D1117;"></div>
                                <input type="color" id="bgColor" value="#0D1117">
                                <div class="color-value">#0D1117</div>
                            </div>
                        </div>
                        <div class="setting-row">
                            <label for="bgColorPresets">Background Presets:</label>
                            <div class="color-presets">
                                <div class="color-preset" style="background-color: #0D1117;" data-color="#0D1117" data-target="bgColor"></div>
                                <div class="color-preset" style="background-color: #121638;" data-color="#121638" data-target="bgColor"></div>
                                <div class="color-preset" style="background-color: #220033;" data-color="#220033" data-target="bgColor"></div>
                                <div class="color-preset" style="background-color: #1a1a2e;" data-color="#1a1a2e" data-target="bgColor"></div>
                                <div class="color-preset" style="background-color: #0f0f1a;" data-color="#0f0f1a" data-target="bgColor"></div>
                            </div>
                        </div>
                        <div class="setting-row">
                            <label for="cellColor">Cell Color:</label>
                            <div class="color-picker-wrapper">
                                <div class="color-preview" style="background-color: #9b59b6;"></div>
                                <input type="color" id="cellColor" value="#9b59b6">
                                <div class="color-value">#9b59b6</div>
                            </div>
                        </div>
                        <div class="setting-row">
                            <label for="cellColorPresets">Cell Presets:</label>
                            <div class="color-presets">
                                <div class="color-preset" style="background-color: #9b59b6;" data-color="#9b59b6" data-target="cellColor"></div>
                                <div class="color-preset" style="background-color: #8e44ad;" data-color="#8e44ad" data-target="cellColor"></div>
                                <div class="color-preset" style="background-color: #3498db;" data-color="#3498db" data-target="cellColor"></div>
                                <div class="color-preset" style="background-color: #e74c3c;" data-color="#e74c3c" data-target="cellColor"></div>
                                <div class="color-preset" style="background-color: #2ecc71;" data-color="#2ecc71" data-target="cellColor"></div>
                            </div>
                        </div>
                        <div class="setting-row">
                            <label for="gridColor">Grid Color:</label>
                            <div class="color-picker-wrapper">
                                <div class="color-preview" style="background-color: #1e1e2e;"></div>
                                <input type="color" id="gridColor" value="#1e1e2e">
                                <div class="color-value">#1e1e2e</div>
                            </div>
                        </div>
                        <div class="setting-row">
                            <label for="gridColorPresets">Grid Presets:</label>
                            <div class="color-presets">
                                <div class="color-preset" style="background-color: #1e1e2e;" data-color="#1e1e2e" data-target="gridColor"></div>
                                <div class="color-preset" style="background-color: #2d2d44;" data-color="#2d2d44" data-target="gridColor"></div>
                                <div class="color-preset" style="background-color: #3a3a5a;" data-color="#3a3a5a" data-target="gridColor"></div>
                                <div class="color-preset" style="background-color: #45455f;" data-color="#45455f" data-target="gridColor"></div>
                                <div class="color-preset" style="background-color: #34344a;" data-color="#34344a" data-target="gridColor"></div>
                            </div>
                        </div>
                        <div class="setting-row">
                            <label for="randomColors">Random Cell Colors:</label>
                            <div class="input-wrapper">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="randomColors">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Advanced Settings Tab -->
                <div class="tab-content" id="advanced">
                    <div class="settings-group">
                        <h3><i class="fas fa-dice"></i> Rule Settings</h3>
                        <div class="setting-row">
                            <label for="ruleSet">Game Rules:</label>
                            <div class="input-wrapper">
                                <select id="ruleSet">
                                    <option value="B3/S23">Conway's Life (B3/S23)</option>
                                    <option value="B36/S23">HighLife (B36/S23)</option>
                                    <option value="B2/S">Seeds (B2/S)</option>
                                    <option value="B36/S125">2x2 (B36/S125)</option>
                                    <option value="B3678/S34678">Day & Night (B3678/S34678)</option>
                                    <option value="custom">Custom Rules</option>
                                </select>
                            </div>
                        </div>
                        <div class="setting-row" id="customRuleContainer" style="display: none;">
                            <label for="customRule">Custom Rule:</label>
                            <div class="input-wrapper">
                                <input type="text" id="customRule" value="B3/S23" placeholder="Enter in B3/S23 format" />
                                <small style="display: block; margin-top: 5px; font-size: 12px; opacity: 0.7;">
                                    Format: Bx/Sy where x = birth neighbors, y = survival neighbors
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-actions">
                    <button class="settings-action-btn" id="resetToDefaults">Reset to Defaults</button>
                    <button class="settings-action-btn primary" id="applySettings">Apply Settings</button>
                </div>
            </div>
        </div>

        <div class="canvas-container">
            <canvas id="gameCanvas" width="800" height="800"></canvas>
            <div class="mobile-controls">
                <button id="zoomIn" aria-label="Zoom In"><i class="fas fa-plus"></i></button>
                <button id="zoomOut" aria-label="Zoom Out"><i class="fas fa-minus"></i></button>
                <button id="resetView" aria-label="Reset View"><i class="fas fa-sync-alt"></i></button>
            </div>
        </div>

        <div class="description-container">
            <button id="showDescriptionBtn">
                <span>Show Instructions & Information</span>
                <i class="fas fa-chevron-down"></i>
            </button>
            <div id="description">
                <img src="conway.jpg" alt="John Horton Conway - Creator of Game of Life">
                <div id="descriptionContent">
                    <p id="descText">
                        Conway's Game of Life is a cellular automaton devised by the mathematician John Horton Conway. It consists of a grid of cells that can live, die, or multiply based on a set of rules. Use the control buttons above to manage the simulation. Click the "Settings" button to access and adjust the game parameters, including the number of rows and columns, simulation speed, colors, initial patterns, and different rule sets. After making any changes to the settings, be sure to click the "Setup Grid" button to apply the new configurations.
                    </p>
                    <p id="instrText"><strong>How to Use Conway's Game of Life:</strong></p>
                    <ol>
                        <li><strong>Configure Settings:</strong> Click the "Settings" button to reveal the game settings panel. Here, you can adjust the number of rows and columns, set the simulation speed (FPS), choose colors for the background, cells, and grid, select an initial pattern, enable Creative Mode, select a rule set (or define a custom rule), and adjust the canvas size.</li>
                        <li><strong>Multiple Rule Sets:</strong> You can choose from several predefined rule sets (B3/S23, B36/S23, B2/S, 2x2, Day & Night), or define a custom rule in the "Settings" panel by selecting "Custom" and entering a rule string (e.g., B3/S23).</li>
                        <li><strong>Symmetric Patterns:</strong> If you want to generate symmetric patterns, check the "Symmetric Patterns" box and specify the desired square size. This will create a random pattern in the specified square and mirror it symmetrically across both the x and y axes.</li>
                        <li><strong>Setup Grid:</strong> After configuring your settings, click the "Setup Grid" button to initialize the grid based on your chosen parameters. This step is crucial to apply any changes you made in the settings.</li>
                        <li><strong>Start Simulation:</strong> Click the "Start" button to begin the evolution of the grid according to the selected rule set.</li>
                        <li><strong>Pause Simulation:</strong> At any point, you can pause the simulation by clicking the "Stop" button.</li>
                        <li><strong>Reset Grid:</strong> To clear the current grid and start fresh, click the "Reset" button.</li>
                        <li><strong>Save and Load Configurations:</strong> Use the "Save" button to download your current grid configuration as a JSON file. You can later load this configuration by clicking the "Load" button and selecting your saved file.</li>
                        <li><strong>Creative Mode:</strong> If you enable Creative Mode, you can manually toggle the state of individual cells by clicking on them within the grid.</li>
                        <li><strong>Random Cell Colors:</strong> If you enable the "Random Cell Colors" option, each live cell will be rendered with a randomly generated color.</li>
                        <li><strong>Important:</strong> Whenever you change any settings, always remember to click the "Setup Grid" button to ensure they are applied correctly before starting the simulation.</li>
                    </ol>
                    <p>Enjoy experimenting with different patterns, rule sets, and settings to explore the fascinating behaviors of cellular automata!</p>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <span id="footerText">Â© 2024 | Conway's Game of Life Simulator</span>
    </footer>

    <script>
        // Game Settings
        const settings = {
            bgColor: '#0D1117',
            cellColor: '#9b59b6',
            gridColor: '#1e1e2e',
            rows: 50,
            cols: 50,
            speed: 10,
            pattern: 'None',
            creativeMode: false,
            randomCellColors: false,
            symmetricPatterns: true,
            squareSize: 10,
            canvasWidth: 800,
            canvasHeight: 800,
            // New fields for rule selection
            ruleSet: 'B3/S23',
            customRule: 'B3/S23'
        };

        // Grid Initialization
        let grid = createGrid(settings.rows, settings.cols);
        let canvas = document.getElementById('gameCanvas');
        let ctx = canvas.getContext('2d');
        let cellWidth, cellHeight;
        let animationId;
        let isRunning = false;

        // Patterns Definitions
        const patterns = {
            "Blinker": [[0,1], [1,1], [2,1]],
            "Glider": [[0,1], [1,2], [2,0], [2,1], [2,2]],
            "Block": [[0,0], [0,1], [1,0], [1,1]],
            "Toad": [[1,2], [1,3], [1,4], [2,1], [2,2], [2,3]],
            "Beacon": [[0,0], [0,1], [1,0], [1,1], [2,2], [2,3], [3,2], [3,3]],
            "Pulsar": [
                [1,3], [1,4], [1,5], [1,9], [1,10], [1,11],
                [3,1], [3,6], [3,8], [3,13],
                [4,1], [4,6], [4,8], [4,13],
                [5,1], [5,6], [5,8], [5,13],
                [6,3], [6,4], [6,5], [6,9], [6,10], [6,11],
                [8,3], [8,4], [8,5], [8,9], [8,10], [8,11],
                [9,1], [9,6], [9,8], [9,13],
                [10,1], [10,6], [10,8], [10,13],
                [11,1], [11,6], [11,8], [11,13],
                [13,3], [13,4], [13,5], [13,9], [13,10], [13,11]
            ],
            "Pentadecathlon": [
                [0,2], [0,3], [1,1], [1,4],
                [2,2], [2,3], [3,2], [3,3],
                [4,2], [4,3], [5,1], [5,4],
                [6,2], [6,3]
            ],
            "LWSS": [
                [0,1], [0,4],
                [1,0], [1,4],
                [2,4],
                [3,0], [3,3]
            ]
        };

        // Create Empty Grid
        function createGrid(rows, cols, randomize=false) {
            let newGrid = [];
            for (let i = 0; i < rows; i++) {
                let row = [];
                for (let j = 0; j < cols; j++) {
                    row.push(randomize ? (Math.random() < 0.3 ? 1 : 0) : 0);
                }
                newGrid.push(row);
            }
            return newGrid;
        }

        // Add Pattern to Grid
        function addPattern(grid, pattern, startX, startY) {
            if (!patterns[pattern]) {
                alert(`Pattern "${pattern}" does not exist.`);
                return;
            }
            patterns[pattern].forEach(([dx, dy]) => {
                let x = startX + dx;
                let y = startY + dy;
                if (x >= 0 && x < grid.length && y >= 0 && y < grid[0].length) {
                    grid[x][y] = 1;
                }
            });
        }

        // Generate Symmetric Patterns
        function generateSymmetricPatterns(grid, squareSize) {
            const rows = grid.length;
            const cols = grid[0].length;
            const centerX = Math.floor(rows / 2);
            const centerY = Math.floor(cols / 2);

            // Define starting points for the four squares
            const topLeftX = centerX - squareSize;
            const topLeftY = centerY - squareSize;
            const topRightX = centerX - squareSize;
            const topRightY = centerY;
            const bottomLeftX = centerX;
            const bottomLeftY = centerY - squareSize;
            const bottomRightX = centerX;
            const bottomRightY = centerY;

            // Generate random pattern for the top-left square
            let square = createGrid(squareSize, squareSize, false);
            for (let i = 0; i < squareSize; i++) {
                for (let j = 0; j < squareSize; j++) {
                    square[i][j] = Math.random() < 0.3 ? 1 : 0;
                }
            }

            // Mirror the square across the x-axis
            let mirroredX = createGrid(squareSize, squareSize, false);
            for (let i = 0; i < squareSize; i++) {
                for (let j = 0; j < squareSize; j++) {
                    mirroredX[i][j] = square[squareSize - 1 - i][j];
                }
            }

            // Mirror the square across the y-axis
            let mirroredY = createGrid(squareSize, squareSize, false);
            for (let i = 0; i < squareSize; i++) {
                for (let j = 0; j < squareSize; j++) {
                    mirroredY[i][j] = square[i][squareSize - 1 - j];
                }
            }

            // Mirror the square across both axes
            let mirroredXY = createGrid(squareSize, squareSize, false);
            for (let i = 0; i < squareSize; i++) {
                for (let j = 0; j < squareSize; j++) {
                    mirroredXY[i][j] = square[squareSize - 1 - i][squareSize - 1 - j];
                }
            }

            // Place the four squares onto the grid
            placeSquare(grid, square, topLeftX, topLeftY);
            placeSquare(grid, mirroredX, topRightX, topRightY);
            placeSquare(grid, mirroredY, bottomLeftX, bottomLeftY);
            placeSquare(grid, mirroredXY, bottomRightX, bottomRightY);
        }

        // Helper function to place a square onto the grid
        function placeSquare(grid, square, startX, startY) {
            for (let i = 0; i < square.length; i++) {
                for (let j = 0; j < square[0].length; j++) {
                    let x = startX + i;
                    let y = startY + j;
                    if (x >= 0 && x < grid.length && y >= 0 && y < grid[0].length) {
                        grid[x][y] = square[i][j];
                    }
                }
            }
        }

        // Parse Rule String (e.g., "B3/S23") => birthNumbers, survivalNumbers
        function parseRuleString(ruleString) {
            // Split by '/'
            // example: "B3/S23" => ["B3", "S23"]
            let [birthPart, survivalPart] = ruleString.split('/');
            // Remove 'B' and 'S'
            birthPart = birthPart.replace('B', '');
            survivalPart = survivalPart.replace('S', '');
            // Convert each character to a number
            let birthNumbers = birthPart.split('').map(Number).filter(num => !isNaN(num));
            let survivalNumbers = survivalPart.split('').map(Number).filter(num => !isNaN(num));
            return { birthNumbers, survivalNumbers };
        }

        // Update Grid Based on Selected Rule Set
        function updateGrid(grid) {
            const rows = grid.length;
            const cols = grid[0].length;
            const newGrid = createGrid(rows, cols, false);

            let ruleString = settings.ruleSet;
            if (ruleString === 'custom') {
                ruleString = settings.customRule;
            }
            const { birthNumbers, survivalNumbers } = parseRuleString(ruleString);

            for (let x = 0; x < rows; x++) {
                for (let y = 0; y < cols; y++) {
                    let neighbors = 0;
                    for (let i = -1; i <= 1; i++) {
                        for (let j = -1; j <= 1; j++) {
                            if (i === 0 && j === 0) continue;
                            let ni = x + i;
                            let nj = y + j;
                            if (ni >= 0 && ni < rows && nj >= 0 && nj < cols) {
                                neighbors += grid[ni][nj];
                            }
                        }
                    }
                    const isAlive = grid[x][y] === 1;
                    if (isAlive) {
                        // Survive?
                        if (survivalNumbers.includes(neighbors)) {
                            newGrid[x][y] = 1;
                        }
                    } else {
                        // Birth?
                        if (birthNumbers.includes(neighbors)) {
                            newGrid[x][y] = 1;
                        }
                    }
                }
            }
            return newGrid;
        }

        // Draw Grid on Canvas
        function drawGrid() {
            ctx.fillStyle = settings.bgColor;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // If we're in fullscreen mode, adjust the canvas
            if (document.fullscreenElement || 
                document.webkitFullscreenElement || 
                document.mozFullScreenElement || 
                document.msFullscreenElement) {
                // Set canvas to fullscreen dimensions
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            } else {
                // Return to original dimensions
                canvas.width = settings.canvasWidth;
                canvas.height = settings.canvasHeight;
            }

            // Clear background with the set color
            ctx.fillStyle = settings.bgColor;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            cellWidth = canvas.width / settings.cols;
            cellHeight = canvas.height / settings.rows;

            for (let x = 0; x < settings.rows; x++) {
                for (let y = 0; y < settings.cols; y++) {
                    if (grid[x][y] === 1) {
                        if (settings.randomCellColors) {
                            ctx.fillStyle = getRandomColor();
                        } else {
                            ctx.fillStyle = settings.cellColor;
                        }
                        ctx.fillRect(y * cellWidth, x * cellHeight, cellWidth, cellHeight);
                    }
                }
            }

            // Draw Grid Lines
            ctx.strokeStyle = settings.gridColor;
            ctx.lineWidth = 0.5;
            // Vertical lines
            for (let y = 0; y <= settings.cols; y++) {
                ctx.beginPath();
                ctx.moveTo(y * cellWidth, 0);
                ctx.lineTo(y * cellWidth, canvas.height);
                ctx.stroke();
            }
            // Horizontal lines
            for (let x = 0; x <= settings.rows; x++) {
                ctx.beginPath();
                ctx.moveTo(0, x * cellHeight);
                ctx.lineTo(canvas.width, x * cellHeight);
                ctx.stroke();
            }
        }

        // Generate Random Color in Hex Format
        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        // Simulation Loop
        function simulate() {
            if (!isRunning) return;
            grid = updateGrid(grid);
            drawGrid();
            animationId = setTimeout(() => {
                requestAnimationFrame(simulate);
            }, 1000 / settings.speed);
        }

        // Start Simulation
        function startSimulation() {
            if (!isRunning) {
                isRunning = true;
                simulate();
                
                // Update button styles for visual feedback
                document.getElementById('startSimulation').style.backgroundColor = 'var(--accent-color)';
                document.getElementById('pauseSimulation').style.backgroundColor = '';
            }
        }

        // Pause Simulation
        function pauseSimulation() {
            isRunning = false;
            clearTimeout(animationId);
            
            // Update button styles for visual feedback
            document.getElementById('startSimulation').style.backgroundColor = '';
            document.getElementById('pauseSimulation').style.backgroundColor = 'var(--accent-color)';
        }

        // Reset Grid
        function resetGrid() {
            pauseSimulation();
            grid = createGrid(settings.rows, settings.cols, false); // Empty grid
            drawGrid();
            
            // Reset button styles
            document.getElementById('startSimulation').style.backgroundColor = '';
            document.getElementById('pauseSimulation').style.backgroundColor = '';
        }

        // Setup Grid
        function setupGrid() {
            settings.rows = parseInt(document.getElementById('rows').value) || 50;
            settings.cols = parseInt(document.getElementById('cols').value) || 50;
            settings.canvasWidth = parseInt(document.getElementById('canvasWidth').value) || 800;
            settings.canvasHeight = parseInt(document.getElementById('canvasHeight').value) || 800;
            settings.speed = parseInt(document.getElementById('speed').value) || 10;
            settings.pattern = document.getElementById('pattern').value;
            settings.creativeMode = document.getElementById('creativeMode').checked;
            settings.randomCellColors = document.getElementById('randomColors').checked;
            settings.symmetricPatterns = document.getElementById('symmetricPatterns').checked;
            settings.squareSize = parseInt(document.getElementById('squareSize').value) || 10;
            settings.bgColor = document.getElementById('bgColor').value;
            settings.cellColor = document.getElementById('cellColor').value;
            settings.gridColor = document.getElementById('gridColor').value;
            settings.ruleSet = document.getElementById('ruleSet').value;
            settings.customRule = document.getElementById('customRule').value;

            // Resize Canvas
            canvas.width = settings.canvasWidth;
            canvas.height = settings.canvasHeight;

            // Create Grid
            if (settings.creativeMode) {
                // Optionally preserve the current grid if you want
                // Here, we do nothing special, you can choose to keep or reset the grid
            } else if (settings.symmetricPatterns) {
                grid = createGrid(settings.rows, settings.cols, false);
                generateSymmetricPatterns(grid, settings.squareSize);
            } else if (settings.pattern !== 'None') {
                grid = createGrid(settings.rows, settings.cols, false);
                // Adjust start position a bit
                addPattern(grid, settings.pattern, Math.floor(settings.rows / 2) - 5, Math.floor(settings.cols / 2) - 5);
            } else {
                grid = createGrid(settings.rows, settings.cols, true); // Random grid
            }
            drawGrid();
            
            // Provide visual feedback that grid was set up
            showNotification("Grid setup complete!");
        }
        
        // Simple notification function
        function showNotification(message) {
            // Create notification element if it doesn't exist
            let notification = document.getElementById('notification');
            if (!notification) {
                notification = document.createElement('div');
                notification.id = 'notification';
                notification.style.position = 'fixed';
                notification.style.bottom = '20px';
                notification.style.left = '50%';
                notification.style.transform = 'translateX(-50%)';
                notification.style.backgroundColor = 'rgba(142, 68, 173, 0.9)';
                notification.style.color = 'white';
                notification.style.padding = '10px 20px';
                notification.style.borderRadius = '50px';
                notification.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
                notification.style.zIndex = '1000';
                notification.style.transition = 'opacity 0.5s ease';
                document.body.appendChild(notification);
            }
            
            // Show message
            notification.textContent = message;
            notification.style.opacity = '1';
            
            // Hide after 2 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
            }, 2000);
        }

        // Toggle Cell State in Creative Mode
        function toggleCell(event) {
            if (!settings.creativeMode) return;
            
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;    // Ratio between canvas width and its display
            const scaleY = canvas.height / rect.height;  // Ratio between canvas height and its display
            
            // Calculate click coordinates
            let clickX, clickY;
            
            // Handle both mouse and touch events
            if (event.type === 'touchstart' || event.type === 'touchmove') {
                // Prevent scrolling when interacting with canvas
                event.preventDefault();
                const touch = event.touches[0];
                clickX = (touch.clientX - rect.left) * scaleX;
                clickY = (touch.clientY - rect.top) * scaleY;
            } else {
                clickX = (event.clientX - rect.left) * scaleX;
                clickY = (event.clientY - rect.top) * scaleY;
            }
            
            // Determine the cell that was clicked
            const col = Math.floor(clickX / cellWidth);
            const row = Math.floor(clickY / cellHeight);
            
            if (row >= 0 && row < settings.rows && col >= 0 && col < settings.cols) {
                grid[row][col] = grid[row][col] ? 0 : 1;
                drawGrid();
            }
        }

        // Save Grid to JSON File
        function saveGrid() {
            const data = {
                rows: settings.rows,
                cols: settings.cols,
                grid: grid,
                canvasWidth: settings.canvasWidth,
                canvasHeight: settings.canvasHeight,
                creativeMode: settings.creativeMode,
                randomCellColors: settings.randomCellColors,
                symmetricPatterns: settings.symmetricPatterns,
                squareSize: settings.squareSize,
                // Additional data to save rule info
                ruleSet: settings.ruleSet,
                customRule: settings.customRule,
                // optional color settings
                bgColor: settings.bgColor,
                cellColor: settings.cellColor,
                gridColor: settings.gridColor,
                pattern: settings.pattern,
                speed: settings.speed
            };
            const json = JSON.stringify(data);
            const blob = new Blob([json], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'game_of_life_map.json';
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification("Configuration saved successfully!");
        }

        // Load Grid from JSON File
        function loadGrid(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.rows && data.cols && data.grid && data.canvasWidth && data.canvasHeight) {
                        settings.rows = data.rows;
                        settings.cols = data.cols;
                        settings.canvasWidth = data.canvasWidth;
                        settings.canvasHeight = data.canvasHeight;
                        settings.creativeMode = data.creativeMode || false;
                        settings.randomCellColors = data.randomCellColors || false;
                        settings.symmetricPatterns = data.symmetricPatterns || false;
                        settings.squareSize = data.squareSize || 10;
                        // Load rule info
                        settings.ruleSet = data.ruleSet || 'B3/S23';
                        settings.customRule = data.customRule || 'B3/S23';
                        // Possibly load color settings
                        settings.bgColor = data.bgColor || settings.bgColor;
                        settings.cellColor = data.cellColor || settings.cellColor;
                        settings.gridColor = data.gridColor || settings.gridColor;
                        settings.pattern = data.pattern || settings.pattern;
                        settings.speed = data.speed || settings.speed;

                        document.getElementById('rows').value = settings.rows;
                        document.getElementById('cols').value = settings.cols;
                        document.getElementById('canvasWidth').value = settings.canvasWidth;
                        document.getElementById('canvasHeight').value = settings.canvasHeight;
                        document.getElementById('creativeMode').checked = settings.creativeMode;
                        document.getElementById('randomColors').checked = settings.randomCellColors;
                        document.getElementById('symmetricPatterns').checked = settings.symmetricPatterns;
                        document.getElementById('squareSize').value = settings.squareSize;
                        document.getElementById('ruleSet').value = settings.ruleSet;
                        document.getElementById('customRule').value = settings.customRule;
                        document.getElementById('bgColor').value = settings.bgColor;
                        document.getElementById('cellColor').value = settings.cellColor;
                        document.getElementById('gridColor').value = settings.gridColor;
                        document.getElementById('pattern').value = settings.pattern;
                        document.getElementById('speed').value = settings.speed;

                        grid = data.grid.map(row => row.slice()); // Deep copy

                        // Resize Canvas
                        canvas.width = settings.canvasWidth;
                        canvas.height = settings.canvasHeight;

                        // Show/hide symmetric settings based on loaded data
                        const symmetricSettings = document.getElementById('symmetricSettings');
                        if (settings.symmetricPatterns) {
                            symmetricSettings.style.display = 'flex';
                        } else {
                            symmetricSettings.style.display = 'none';
                        }

                        // Show/hide custom rule container
                        const customRuleContainer = document.getElementById('customRuleContainer');
                        if (settings.ruleSet === 'custom') {
                            customRuleContainer.style.display = 'flex';
                        } else {
                            customRuleContainer.style.display = 'none';
                        }

                        drawGrid();
                        showNotification("Configuration loaded successfully!");
                    } else {
                        alert('Invalid file format.');
                    }
                } catch (err) {
                    alert('Error loading the file.');
                }
            };
            reader.readAsText(file);
        }

        // Toggle Settings Panel Visibility
        function toggleSettings() {
            const settingsPanel = document.getElementById('settingsPanel');
            if (settingsPanel.style.display === 'none' || settingsPanel.style.display === '') {
                settingsPanel.style.display = 'flex';
                settingsPanel.style.flexDirection = 'column';
                document.getElementById('configure').style.backgroundColor = 'var(--accent-color)';
                
                // Update color previews
                updateColorPreviews();
            } else {
                settingsPanel.style.display = 'none';
                document.getElementById('configure').style.backgroundColor = '';
            }
        }
        
        // Update color preview boxes
        function updateColorPreviews() {
            // Background color
            const bgColorInput = document.getElementById('bgColor');
            const bgColorPreview = bgColorInput.previousElementSibling;
            const bgColorValue = bgColorInput.nextElementSibling;
            bgColorPreview.style.backgroundColor = bgColorInput.value;
            if (bgColorValue) bgColorValue.textContent = bgColorInput.value;
            
            // Cell color
            const cellColorInput = document.getElementById('cellColor');
            const cellColorPreview = cellColorInput.previousElementSibling;
            const cellColorValue = cellColorInput.nextElementSibling;
            cellColorPreview.style.backgroundColor = cellColorInput.value;
            if (cellColorValue) cellColorValue.textContent = cellColorInput.value;
            
            // Grid color
            const gridColorInput = document.getElementById('gridColor');
            const gridColorPreview = gridColorInput.previousElementSibling;
            const gridColorValue = gridColorInput.nextElementSibling;
            gridColorPreview.style.backgroundColor = gridColorInput.value;
            if (gridColorValue) gridColorValue.textContent = gridColorInput.value;
        }

        // Handle color input changes
        function handleColorChange(event) {
            const colorPicker = event.target;
            const preview = colorPicker.previousElementSibling;
            const valueDisplay = colorPicker.nextElementSibling;
            
            preview.style.backgroundColor = colorPicker.value;
            if (valueDisplay) valueDisplay.textContent = colorPicker.value;
        }
        
        // Handle preset color selection
        function handleColorPreset(event) {
            if (event.target.classList.contains('color-preset')) {
                const color = event.target.getAttribute('data-color');
                const targetId = event.target.getAttribute('data-target');
                
                if (color && targetId) {
                    const colorInput = document.getElementById(targetId);
                    colorInput.value = color;
                    
                    // Trigger the change event
                    const changeEvent = new Event('input');
                    colorInput.dispatchEvent(changeEvent);
                }
            }
        }
        
        // Handle speed slider change
        function handleSpeedSlider(event) {
            const sliderValue = parseInt(event.target.value);
            document.getElementById('speedValue').textContent = sliderValue;
            document.getElementById('speed').value = sliderValue;
        }
        
        // Reset settings to defaults
        function resetToDefaults() {
            // Grid dimensions
            document.getElementById('rows').value = 50;
            document.getElementById('cols').value = 50;
            document.getElementById('canvasWidth').value = 800;
            document.getElementById('canvasHeight').value = 800;
            
            // Simulation settings
            document.getElementById('speedSlider').value = 10;
            document.getElementById('speedValue').textContent = 10;
            document.getElementById('speed').value = 10;
            document.getElementById('pattern').value = 'None';
            document.getElementById('creativeMode').checked = false;
            document.getElementById('symmetricPatterns').checked = false;
            
            // Color settings
            document.getElementById('bgColor').value = '#0D1117';
            document.getElementById('cellColor').value = '#9b59b6';
            document.getElementById('gridColor').value = '#1e1e2e';
            document.getElementById('randomColors').checked = false;
            
            // Rule settings
            document.getElementById('ruleSet').value = 'B3/S23';
            document.getElementById('customRule').value = 'B3/S23';
            
            // Update all previews
            updateColorPreviews();
            
            // Hide conditional elements
            document.getElementById('symmetricSettings').style.display = 'none';
            document.getElementById('customRuleContainer').style.display = 'none';
            
            showNotification("Settings reset to defaults");
        }
        
        // New: Initialize the settings UI when the page loads
        function initializeSettings() {
            // Add event listeners for tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', switchTab);
            });
            
            // Add event listeners for color pickers
            document.querySelectorAll('input[type="color"]').forEach(picker => {
                picker.addEventListener('input', handleColorChange);
            });
            
            // Add event listeners for color presets
            document.querySelectorAll('.color-presets').forEach(presetContainer => {
                presetContainer.addEventListener('click', handleColorPreset);
            });
            
            // Add event listener for speed slider
            const speedSlider = document.getElementById('speedSlider');
            if (speedSlider) {
                speedSlider.addEventListener('input', handleSpeedSlider);
            }
            
            // Add event listener for Apply button
            const applyButton = document.getElementById('applySettings');
            if (applyButton) {
                applyButton.addEventListener('click', setupGrid);
            }
            
            // Add event listener for Reset button
            const resetButton = document.getElementById('resetToDefaults');
            if (resetButton) {
                resetButton.addEventListener('click', resetToDefaults);
            }
            
            // Initialize all visual elements
            updateColorPreviews();
            
            // Set default checkbox for symmetric patterns
            document.getElementById('symmetricPatterns').checked = true;
            // Show symmetric settings by default
            document.getElementById('symmetricSettings').style.display = 'flex';
            document.getElementById('symmetricSettings').style.flexDirection = 'row';
            document.getElementById('symmetricSettings').style.alignItems = 'center';
        }

        // Toggle Symmetric Settings Visibility
        function toggleSymmetricSettings() {
            const symmetricCheckbox = document.getElementById('symmetricPatterns');
            const symmetricSettings = document.getElementById('symmetricSettings');
            if (symmetricCheckbox.checked) {
                symmetricSettings.style.display = 'flex';
                symmetricSettings.style.flexDirection = 'row';
                symmetricSettings.style.alignItems = 'center';
            } else {
                symmetricSettings.style.display = 'none';
            }
        }

        // Handle ruleSet change (show/hide custom rule input)
        function handleRuleSetChange() {
            const ruleSelect = document.getElementById('ruleSet');
            const customRuleContainer = document.getElementById('customRuleContainer');
            if (ruleSelect.value === 'custom') {
                customRuleContainer.style.display = 'flex';
                customRuleContainer.style.flexDirection = 'row';
                customRuleContainer.style.alignItems = 'center';
            } else {
                customRuleContainer.style.display = 'none';
            }
        }
        
        // Toggle description visibility
        function toggleDescription() {
            const description = document.getElementById('description');
            const button = document.getElementById('showDescriptionBtn');
            description.classList.toggle('show');
            button.classList.toggle('active');
            
            if (button.classList.contains('active')) {
                button.querySelector('span').textContent = 'Hide Instructions & Information';
            } else {
                button.querySelector('span').textContent = 'Show Instructions & Information';
            }
        }
        
        // Switch tabs in settings panel
        function switchTab(event) {
            const tabButton = event.currentTarget;
            const tabName = tabButton.getAttribute('data-tab');
            
            // Update active tab button
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            tabButton.classList.add('active');
            
            // Show selected tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
        }
        
        // Add tooltips to buttons
        function addTooltips() {
            const buttons = document.querySelectorAll('#controlButtons button');
            buttons.forEach(button => {
                const tooltip = button.getAttribute('aria-label');
                if (tooltip) {
                    button.classList.add('tooltip');
                    const tooltipSpan = document.createElement('span');
                    tooltipSpan.className = 'tooltiptext';
                    tooltipSpan.textContent = tooltip;
                    button.appendChild(tooltipSpan);
                }
            });
        }
        
        // Mobile zoom and pan handling variables
        let scale = 1;
        let offsetX = 0;
        let offsetY = 0;
        let startX, startY;
        let isDragging = false;
        
        // Handle zoom in button
        function handleZoomIn() {
            if (scale < 3) { // Maximum zoom level
                scale += 0.2;
                updateCanvasTransform();
                showNotification("Zoomed in: " + Math.round(scale * 100) + "%");
            }
        }
        
        // Handle zoom out button
        function handleZoomOut() {
            if (scale > 0.5) { // Minimum zoom level
                scale -= 0.2;
                updateCanvasTransform();
                showNotification("Zoomed out: " + Math.round(scale * 100) + "%");
            }
        }
        
        // Reset zoom and pan
        function resetCanvasView() {
            scale = 1;
            offsetX = 0;
            offsetY = 0;
            updateCanvasTransform();
            showNotification("View reset");
        }
        
        // Update canvas transform based on zoom and pan
        function updateCanvasTransform() {
            const container = document.querySelector('.canvas-container');
            const canvas = document.getElementById('gameCanvas');
            
            canvas.style.transform = `scale(${scale}) translate(${offsetX}px, ${offsetY}px)`;
            canvas.style.transformOrigin = 'center center';
        }
        
        // Handle touch start for panning
        function handleTouchStart(e) {
            // Only handle pan if not in creative mode
            if (!settings.creativeMode && e.touches.length === 1) {
                isDragging = true;
                startX = e.touches[0].clientX - offsetX;
                startY = e.touches[0].clientY - offsetY;
                e.preventDefault();
            }
        }
        
        // Handle touch move for panning
        function handleTouchMove(e) {
            if (!settings.creativeMode && isDragging && e.touches.length === 1) {
                offsetX = e.touches[0].clientX - startX;
                offsetY = e.touches[0].clientY - startY;
                updateCanvasTransform();
                e.preventDefault();
            }
        }
        
        // Handle touch end
        function handleTouchEnd() {
            isDragging = false;
        }
        
        // Initialize Grid
        function initialize() {
            // Initialize settings panel
            initializeSettings();
            
            // Add tooltips for all buttons
            addTooltips();
            
            // Add event listener for description toggle
            document.getElementById('showDescriptionBtn').addEventListener('click', toggleDescription);
            
            // Setup initial grid
            setupGrid();

            // Add touch event listeners for mobile
            canvas.addEventListener('touchstart', toggleCell, { passive: false });
            
            // Add zoom and pan controls for mobile
            document.getElementById('zoomIn').addEventListener('click', handleZoomIn);
            document.getElementById('zoomOut').addEventListener('click', handleZoomOut);
            document.getElementById('resetView').addEventListener('click', resetCanvasView);
            
            const canvasContainer = document.querySelector('.canvas-container');
            canvasContainer.addEventListener('touchstart', handleTouchStart, { passive: false });
            canvasContainer.addEventListener('touchmove', handleTouchMove, { passive: false });
            canvasContainer.addEventListener('touchend', handleTouchEnd);
            
            // Check if mobile device and set initial canvas dimensions accordingly
            adjustForMobile();
        }
        
        // Function to adjust settings for mobile devices
        function adjustForMobile() {
            // Check if mobile device
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isMobile) {
                // Adjust canvas size to fit screen
                const screenWidth = window.innerWidth - 20; // Account for padding
                const screenHeight = window.innerHeight * 0.5; // Use half the screen height
                
                // Update settings to match screen dimensions
                settings.canvasWidth = screenWidth;
                settings.canvasHeight = screenHeight;
                
                // Reduce grid size for better performance on mobile
                if (settings.rows > 30) {
                    settings.rows = 30;
                    document.getElementById('rows').value = 30;
                }
                
                if (settings.cols > 30) {
                    settings.cols = 30;
                    document.getElementById('cols').value = 30;
                }
                
                // Reset canvas dimensions
                canvas.width = settings.canvasWidth;
                canvas.height = settings.canvasHeight;
                
                // Redraw grid with new dimensions
                drawGrid();
                
                // Show notification for mobile mode
                showNotification("Mobile mode activated");
            }
        }
        
        // Event Listeners
        document.getElementById('configure').addEventListener('click', toggleSettings);
        document.getElementById('setupGrid').addEventListener('click', setupGrid);
        document.getElementById('startSimulation').addEventListener('click', startSimulation);
        document.getElementById('pauseSimulation').addEventListener('click', pauseSimulation);
        document.getElementById('resetGrid').addEventListener('click', resetGrid);
        document.getElementById('saveGrid').addEventListener('click', saveGrid);
        document.getElementById('loadGrid').addEventListener('click', () => {
            document.getElementById('fileInput').click();
        });
        document.getElementById('fileInput').addEventListener('change', loadGrid);
        document.getElementById('fullscreenToggle').addEventListener('click', toggleFullscreen);
        canvas.addEventListener('click', toggleCell);
        document.getElementById('symmetricPatterns').addEventListener('change', toggleSymmetricSettings);
        document.getElementById('ruleSet').addEventListener('change', handleRuleSetChange);
        
        // Start Initialization on Page Load
        window.onload = initialize;

        // Handle Fullscreen Toggle
        function toggleFullscreen() {
            const canvas = document.getElementById('gameCanvas');
            const fullscreenButton = document.getElementById('fullscreenToggle');
            
            if (!document.fullscreenElement && 
                !document.mozFullScreenElement && 
                !document.webkitFullscreenElement && 
                !document.msFullscreenElement) {
                // Enter fullscreen mode
                if (canvas.requestFullscreen) {
                    canvas.requestFullscreen();
                } else if (canvas.mozRequestFullScreen) { // Firefox
                    canvas.mozRequestFullScreen();
                } else if (canvas.webkitRequestFullscreen) { // Chrome, Safari
                    canvas.webkitRequestFullscreen();
                } else if (canvas.msRequestFullscreen) { // IE/Edge
                    canvas.msRequestFullscreen();
                }
                // Change button icon
                fullscreenButton.innerHTML = '<i class="fas fa-compress"></i> Exit Fullscreen';
                fullscreenButton.classList.add('active');
                showNotification("Fullscreen mode activated");
            } else {
                // Exit fullscreen mode
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.mozCancelFullScreen) { // Firefox
                    document.mozCancelFullScreen();
                } else if (document.webkitExitFullscreen) { // Chrome, Safari
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) { // IE/Edge
                    document.msExitFullscreen();
                }
                // Change icon back
                fullscreenButton.innerHTML = '<i class="fas fa-expand"></i> Fullscreen';
                fullscreenButton.classList.remove('active');
                showNotification("Normal screen mode");
            }
            
            // Adjust canvas size and redraw grid
            setTimeout(() => {
                drawGrid();
            }, 100);
        }
        
        // Add listeners for fullscreen state change
        document.addEventListener('fullscreenchange', handleFullscreenChange);
        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
        document.addEventListener('mozfullscreenchange', handleFullscreenChange);
        document.addEventListener('MSFullscreenChange', handleFullscreenChange);
        
        // Handle fullscreen state change
        function handleFullscreenChange() {
            const fullscreenButton = document.getElementById('fullscreenToggle');
            
            if (document.fullscreenElement || 
                document.webkitFullscreenElement || 
                document.mozFullScreenElement || 
                document.msFullscreenElement) {
                // We're in fullscreen mode
                fullscreenButton.innerHTML = '<i class="fas fa-compress"></i> Exit Fullscreen';
                fullscreenButton.classList.add('active');
            } else {
                // We're not in fullscreen mode
                fullscreenButton.innerHTML = '<i class="fas fa-expand"></i> Fullscreen';
                fullscreenButton.classList.remove('active');
            }
            
            // Redraw grid to adjust to the new size
            drawGrid();
        }
        
        // Handle window resize
        window.addEventListener('resize', function() {
            // If we're in fullscreen mode, adjust the canvas to the new window size
            if (document.fullscreenElement || 
                document.webkitFullscreenElement || 
                document.mozFullScreenElement || 
                document.msFullscreenElement) {
                drawGrid();
            }
        });
    </script>

</body>
</html>
